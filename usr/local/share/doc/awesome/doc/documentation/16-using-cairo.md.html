<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Topic 16-using-cairo.md - awesome API documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
   <script>
     function show_extra(id) {
        var cur = document.getElementById("item"+id).className

        if (cur == "hide_extra") {
            document.getElementById("item"+id).className = "show_more"
            document.getElementById("button"+id).className = "hide_extra"
        }
     }
   </script>

</head>
<body>

<div id="container">
<div id="main">





<!-- Menu -->

<div id="navigation">
<h1>awesome</h1>

<div class="select">
    <select name="theme" id="theme-select">
       <option selected disabled>Choose a theme</option>
       <option value="light">LDoc Light</option>
       <option value="dark">Awesome Dark</option>
       <option value="monokai">Monokai</option>
       <option value="onedark">One Dark</option>
    </select>
 </div>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Using_LGI_in_Awesome">Using LGI in Awesome </a></li>
<li><a href="#The_Cairo_API">The Cairo API </a></li>
</ul>


<h2>Documentation</h2>
<ul class="nowrap">
  <li><a href="../documentation/00-authors.md.html">Authors</a></li>
  <li><a href="../documentation/01-readme.md.html">Readme</a></li>
  <li><a href="../documentation/02-contributing.md.html">Contributing</a></li>
  <li><a href="../documentation/03-declarative-layout.md.html">The Widget system</a></li>
  <li><a href="../documentation/04-new-widgets.md.html">Creating new widget</a></li>
  <li><a href="../documentation/05-awesomerc.md.html">Default configuration file documentation</a></li>
  <li><a href="../documentation/06-appearance.md.html">Change Awesome appearance</a></li>
  <li><a href="../documentation/07-my-first-awesome.md.html">My first Awesome</a></li>
  <li><a href="../documentation/08-client-layout-system.md.html">The AwesomeWM client layout system</a></li>
  <li><a href="../documentation/09-options.md.html">Startup options</a></li>
  <li><a href="../documentation/10-building-and-testing.md.html">Building and Testing</a></li>
  <li><strong>Using Cairo and LGI</strong></li>
  <li><a href="../documentation/17-porting-tips.md.html">Tips for upgrading your configuration</a></li>
  <li><a href="../documentation/89-NEWS.md.html">NEWS</a></li>
  <li><a href="../documentation/90-FAQ.md.html">FAQ</a></li>
</ul>
<h2>Core components</h2>
<ul class="nowrap">
  <li><a href="../core_components/awesome.html">awesome</a></li>
  <li><a href="../core_components/awful.keygrabber.html">awful.keygrabber</a></li>
  <li><a href="../core_components/client.html">client<span class='listplusign'> and awful.client</span></a></li>
  <li><a href="../core_components/drawable.html">drawable</a></li>
  <li><a href="../core_components/gears.timer.html">gears.timer</a></li>
  <li><a href="../core_components/mousegrabber.html">mousegrabber</a></li>
  <li><a href="../core_components/naughty.action.html">naughty.action</a></li>
  <li><a href="../core_components/naughty.notification.html">naughty.notification</a></li>
  <li><a href="../core_components/root.html">root</a></li>
  <li><a href="../core_components/screen.html">screen<span class='listplusign'> and awful.screen</span></a></li>
  <li><a href="../core_components/tag.html">tag<span class='listplusign'> and awful.tag</span></a></li>
</ul>
<h2>Input handling</h2>
<ul class="nowrap">
  <li><a href="../input_handling/awful.button.html">awful.button</a></li>
  <li><a href="../input_handling/awful.key.html">awful.key</a></li>
  <li><a href="../input_handling/awful.keyboard.html">awful.keyboard</a></li>
  <li><a href="../input_handling/mouse.html">mouse</a></li>
</ul>
<h2>Declarative rules</h2>
<ul class="nowrap">
  <li><a href="../declarative_rules/ruled.client.html">ruled.client</a></li>
  <li><a href="../declarative_rules/ruled.notifications.html">ruled.notifications</a></li>
</ul>
<h2>Widgets</h2>
<ul class="nowrap">
  <li><a href="../widgets/awful.widget.button.html">awful.widget.button</a></li>
  <li><a href="../widgets/awful.widget.clienticon.html">awful.widget.clienticon</a></li>
  <li><a href="../widgets/awful.widget.keyboardlayout.html">awful.widget.keyboardlayout</a></li>
  <li><a href="../widgets/awful.widget.launcher.html">awful.widget.launcher</a></li>
  <li><a href="../widgets/awful.widget.layoutbox.html">awful.widget.layoutbox</a></li>
  <li><a href="../widgets/awful.widget.layoutlist.html">awful.widget.layoutlist</a></li>
  <li><a href="../widgets/awful.widget.prompt.html">awful.widget.prompt</a></li>
  <li><a href="../widgets/awful.widget.taglist.html">awful.widget.taglist</a></li>
  <li><a href="../widgets/awful.widget.tasklist.html">awful.widget.tasklist</a></li>
  <li><a href="../widgets/awful.widget.watch.html">awful.widget.watch</a></li>
  <li><a href="../widgets/naughty.list.actions.html">naughty.list.actions</a></li>
  <li><a href="../widgets/naughty.list.notifications.html">naughty.list.notifications</a></li>
  <li><a href="../widgets/naughty.widget.icon.html">naughty.widget.icon</a></li>
  <li><a href="../widgets/naughty.widget.message.html">naughty.widget.message</a></li>
  <li><a href="../widgets/naughty.widget.title.html">naughty.widget.title</a></li>
  <li><a href="../widgets/wibox.widget.calendar.html">wibox.widget.calendar</a></li>
  <li><a href="../widgets/wibox.widget.checkbox.html">wibox.widget.checkbox</a></li>
  <li><a href="../widgets/wibox.widget.graph.html">wibox.widget.graph</a></li>
  <li><a href="../widgets/wibox.widget.imagebox.html">wibox.widget.imagebox</a></li>
  <li><a href="../widgets/wibox.widget.piechart.html">wibox.widget.piechart</a></li>
  <li><a href="../widgets/wibox.widget.progressbar.html">wibox.widget.progressbar</a></li>
  <li><a href="../widgets/wibox.widget.separator.html">wibox.widget.separator</a></li>
  <li><a href="../widgets/wibox.widget.slider.html">wibox.widget.slider</a></li>
  <li><a href="../widgets/wibox.widget.systray.html">wibox.widget.systray</a></li>
  <li><a href="../widgets/wibox.widget.textbox.html">wibox.widget.textbox</a></li>
  <li><a href="../widgets/wibox.widget.textclock.html">wibox.widget.textclock</a></li>
</ul>
<h2>Widget containers</h2>
<ul class="nowrap">
  <li><a href="../widget_containers/awful.widget.only_on_screen.html">awful.widget.only_on_screen</a></li>
  <li><a href="../widget_containers/naughty.widget.background.html">naughty.widget.background</a></li>
  <li><a href="../widget_containers/wibox.container.arcchart.html">wibox.container.arcchart</a></li>
  <li><a href="../widget_containers/wibox.container.background.html">wibox.container.background</a></li>
  <li><a href="../widget_containers/wibox.container.border.html">wibox.container.border</a></li>
  <li><a href="../widget_containers/wibox.container.constraint.html">wibox.container.constraint</a></li>
  <li><a href="../widget_containers/wibox.container.margin.html">wibox.container.margin</a></li>
  <li><a href="../widget_containers/wibox.container.mirror.html">wibox.container.mirror</a></li>
  <li><a href="../widget_containers/wibox.container.place.html">wibox.container.place</a></li>
  <li><a href="../widget_containers/wibox.container.radialprogressbar.html">wibox.container.radialprogressbar</a></li>
  <li><a href="../widget_containers/wibox.container.rotate.html">wibox.container.rotate</a></li>
  <li><a href="../widget_containers/wibox.container.scroll.html">wibox.container.scroll</a></li>
  <li><a href="../widget_containers/wibox.container.tile.html">wibox.container.tile</a></li>
</ul>
<h2>Widget layouts</h2>
<ul class="nowrap">
  <li><a href="../widget_layouts/wibox.layout.align.html">wibox.layout.align</a></li>
  <li><a href="../widget_layouts/wibox.layout.fixed.html">wibox.layout.fixed</a></li>
  <li><a href="../widget_layouts/wibox.layout.flex.html">wibox.layout.flex</a></li>
  <li><a href="../widget_layouts/wibox.layout.grid.html">wibox.layout.grid</a></li>
  <li><a href="../widget_layouts/wibox.layout.manual.html">wibox.layout.manual</a></li>
  <li><a href="../widget_layouts/wibox.layout.ratio.html">wibox.layout.ratio</a></li>
  <li><a href="../widget_layouts/wibox.layout.stack.html">wibox.layout.stack</a></li>
</ul>
<h2>Popups and bars</h2>
<ul class="nowrap">
  <li><a href="../popups_and_bars/awful.hotkeys_popup.widget.html">awful.hotkeys_popup.widget</a></li>
  <li><a href="../popups_and_bars/awful.menu.html">awful.menu</a></li>
  <li><a href="../popups_and_bars/awful.popup.html">awful.popup</a></li>
  <li><a href="../popups_and_bars/awful.titlebar.html">awful.titlebar</a></li>
  <li><a href="../popups_and_bars/awful.tooltip.html">awful.tooltip</a></li>
  <li><a href="../popups_and_bars/awful.wallpaper.html">awful.wallpaper</a></li>
  <li><a href="../popups_and_bars/awful.wibar.html">awful.wibar</a></li>
  <li><a href="../popups_and_bars/awful.widget.calendar_popup.html">awful.widget.calendar_popup</a></li>
  <li><a href="../popups_and_bars/menubar.html">menubar</a></li>
  <li><a href="../popups_and_bars/naughty.layout.box.html">naughty.layout.box</a></li>
  <li><a href="../popups_and_bars/naughty.layout.legacy.html">naughty.layout.legacy</a></li>
  <li><a href="../popups_and_bars/wibox.html">wibox</a></li>
</ul>
<h2>Utility libraries</h2>
<ul class="nowrap">
  <li><a href="../utility_libraries/gears.debug.html">gears.debug</a></li>
  <li><a href="../utility_libraries/gears.filesystem.html">gears.filesystem</a></li>
  <li><a href="../utility_libraries/gears.geometry.html">gears.geometry</a></li>
  <li><a href="../utility_libraries/gears.math.html">gears.math</a></li>
  <li><a href="../utility_libraries/gears.object.html">gears.object</a></li>
  <li><a href="../utility_libraries/gears.protected_call.html">gears.protected_call</a></li>
  <li><a href="../utility_libraries/gears.sort.html">gears.sort</a></li>
  <li><a href="../utility_libraries/gears.string.html">gears.string</a></li>
  <li><a href="../utility_libraries/gears.table.html">gears.table</a></li>
  <li><a href="../utility_libraries/gears.wallpaper.html">gears.wallpaper</a></li>
</ul>
<h2>Theme related libraries</h2>
<ul class="nowrap">
  <li><a href="../theme_related_libraries/beautiful.html">beautiful</a></li>
  <li><a href="../theme_related_libraries/gears.color.html">gears.color</a></li>
  <li><a href="../theme_related_libraries/gears.shape.html">gears.shape</a></li>
</ul>
<h2>Libraries</h2>
<ul class="nowrap">
  <li><a href="../libraries/awful.completion.html">awful.completion</a></li>
  <li><a href="../libraries/awful.hotkeys_popup.html">awful.hotkeys_popup</a></li>
  <li><a href="../libraries/awful.layout.html">awful.layout</a></li>
  <li><a href="../libraries/awful.permissions.html">awful.permissions</a></li>
  <li><a href="../libraries/awful.placement.html">awful.placement</a></li>
  <li><a href="../libraries/awful.prompt.html">awful.prompt</a></li>
  <li><a href="../libraries/awful.rules.html">awful.rules</a></li>
  <li><a href="../libraries/awful.spawn.html">awful.spawn</a></li>
  <li><a href="../libraries/awful.util.html">awful.util</a></li>
  <li><a href="../libraries/dbus.html">dbus</a></li>
  <li><a href="../libraries/gears.matcher.html">gears.matcher</a></li>
  <li><a href="../libraries/gears.surface.html">gears.surface</a></li>
  <li><a href="../libraries/menubar.menu_gen.html">menubar.menu_gen</a></li>
  <li><a href="../libraries/menubar.utils.html">menubar.utils</a></li>
  <li><a href="../libraries/naughty.html">naughty</a></li>
  <li><a href="../libraries/selection.html">selection</a></li>
  <li><a href="../libraries/wibox.widget.html">wibox.widget</a></li>
</ul>
<h2>Sample files</h2>
<ul class="nowrap">
  <li><a href="../sample files/rc.lua.html">rc.lua</a></li>
  <li><a href="../sample files/theme.lua.html">theme.lua</a></li>
</ul>
<h2>Classes</h2>
<ul class="nowrap">
  <li><a href="../classes/awful.screenshot.html">awful.screenshot</a></li>
  <li><a href="../classes/awful.widget.common.html">awful.widget.common</a></li>
  <li><a href="../classes/gears.cache.html">gears.cache</a></li>
  <li><a href="../classes/gears.matrix.html">gears.matrix</a></li>
  <li><a href="../classes/menubar.icon_theme.html">menubar.icon_theme</a></li>
  <li><a href="../classes/menubar.index_theme.html">menubar.index_theme</a></li>
  <li><a href="../classes/wibox.hierarchy.html">wibox.hierarchy</a></li>
  <li><a href="../classes/wibox.widget.base.html">wibox.widget.base</a></li>
  <li><a href="../classes/xproperties.html">xproperties</a></li>
</ul>

</div>

<div id="content">

    <h1>Using Cairo and LGI</h1>

<p>The interface of Awesome is mostly based on a library called LGI. It provides
access to C libraries such as GTK, GLib, Cairo, Pango, PangoCairo and RSVG using
Lua code without having to write actual &ldquo;glue&rdquo; C code.</p>

<p>This is done using the GObject-introspection framework. The main advantage is
the time saved and large number of features exposed for free. The downside is
the lack of proper Lua centric documentation and examples. Some examples can be
found in <a href="https://github.com/pavouk/lgi/tree/master/docs">LGI&rsquo;s own documentation</a>,
but this does not directly explain how to use a concrete API.
Using other APIs requires some trial and error, and can be even impossible if
the introspection data is missing or inaccurate.
Using low-level APIs directly can easily cause crashes.
It is the programmer&rsquo;s responsibility to properly check return and error
values.</p>

<p><a name="Using_LGI_in_Awesome"></a></p>

<h2>Using LGI in Awesome</h2>

<p>GObject and Gnome centric libraries tend to use the common C practice of
emulating namespaces using underscores in function names.
LGI exposes a proper namespace based API. For example, if the C function is:</p>

<pre>
cairo_image_surface_create()
</pre>


<p>Then the LGI equivalent is:</p>

<pre>
lgi.cairo.ImageSurface.create()
</pre>


<p>The same goes for enums:</p>

<pre>
CAIRO_FORMAT_ARGB32
</pre>


<p>becomes:</p>

<pre>
lgi.cairo.Format.ARGB32
</pre>


<p>LGI is also object oriented while the C API is function based. When those
functions take the &ldquo;class&rdquo; &ldquo;object&rdquo;, then this:</p>

<pre>
cairo_line_to(cr, x, y)
</pre>


<p>can be expressed as:</p>

<pre>
cr:line_to(x, y)
</pre>


<p>It is however important to note some inconsistencies. For example, Cairo is
called <code>lgi.cairo</code> while GLib is called <code>lgi.GLib</code>. Figuring this out will
require some experimenting. The best way to do this without actually
reloading Awesome is to open the <code>lua</code> command in a terminal and use <a href="https://www.lua.org/manual/5.2/manual.html#pdf-print">print</a>:</p>

<pre>
<span class="global">print</span>(<span class="string">"This will print a table address:"</span>, <span class="global">require</span>(<span class="string">"lgi"</span>).cairo)
<span class="global">print</span>(<span class="string">"This will print an error:"</span>, <span class="global">require</span>(<span class="string">"lgi"</span>).Cairo)
</pre>


<p>It is recommended to avoid using <a href="https://www.lua.org/manual/5.2/manual.html#pdf-require">require</a> always when using a function, but
include the libraries at the top of your <a href="../sample files/rc.lua.html#">rc.lua</a> or Lua module instead:</p>

<pre>
<span class="keyword">local</span> cairo = <span class="global">require</span>(<span class="string">"lgi"</span>).cairo
</pre>


<p><a name="The_Cairo_API"></a></p>

<h2>The Cairo API</h2>

<p>Cairo is a 2D graphic library used by Awesome, Gnome and XFCE. It allows to
e.g. paint paths on a <code>surface</code>.
Awesome uses it internally and being able to call it directly is a powerful
feature.</p>

<p>The following concepts are necessary to be able to use Cairo:</p>

<p><strong>Surface</strong>:</p>

<p>A surface is the area where the painting will be done. There are multiple types
of surfaces including:</p>

<ul>
<li>Color images with transparency (<code>ARGB32</code>) or without (<code>RGB24</code>)</li>
<li>Monochrome image surfaces with transparency (<code>A8</code>) or without (<code>A1</code>)</li>
<li>SVG vectorial surfaces</li>
<li>Native (XCB) surfaces</li>
<li>Framebuffers and other less interesting ones (from the point of
view of Awesome)</li>
</ul>


<p>For more details see <a href="https://cairographics.org/manual/cairo-Image-Surfaces.html">Surfaces</a>.</p>

<p><strong>Sources</strong>:</p>

<p>Sources are elements like colors, patterns or gradients. See <a href="../theme_related_libraries/gears.color.html#">gears.color</a> for
common sources.</p>

<p>For more details see <a href="http://cairographics.org/manual/cairo-cairo-pattern-t.html">Pattern</a>.</p>

<p><strong>Context and paths</strong>:</p>

<p>A context is the proxy between the program and the surface, and holds a path.
Paths are something like a line, circle or rectangle, which may or
may not be closed (a shape).</p>

<p>All drawing operations on a surface are done via a context.
The current path is extended until it is used and reset (see next section).
Until then nothing will be drawn to the surface.  For example:</p>

<pre>
cr:rectangle(<span class="number">0</span> , <span class="number">0</span> , <span class="number">10</span>, <span class="number">10</span>)
cr:rectangle(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)
</pre>


<p>will not do anything until the operation is applied to the context.</p>

<p>For more details, read:</p>

<ul>
<li><a href="http://cairographics.org/manual/cairo-Paths.html">Path</a></li>
<li><a href="http://cairographics.org/manual/cairo-cairo-t.html">Context</a></li>
<li><a href="http://cairographics.org/manual/cairo-Transformations.html">Transformation</a></li>
</ul>


<p>A context also holds a transformation matrix (see <a href="../classes/gears.matrix.html#">gears.matrix</a>), which is
used when applying an operation.</p>

<p><strong>Operations</strong>:</p>

<p>Multiple operations can be done with the paths. The most common are:</p>

<ul>
<li><em>fill</em>: Fill the path with the current source.</li>
<li><em>stroke</em>: Paint the path outline with the current source.</li>
<li><em>mask</em>: Use the current source as an alpha mask while painting with the
current operator.</li>
<li><em>clip</em>: Crop the surface&rsquo;s workarea so nothing outside of the clip will be
affected by all following operations.</li>
</ul>


<p><strong>Operators</strong>:</p>

<p><a href="http://cairographics.org/operators/">Operators</a> are modifiers used when
applying operations.</p>

<h3>Cairo in Awesome</h3>

<p>The <a href="../popups_and_bars/wibox.html#">wibox</a>es, <a href="../popups_and_bars/awful.wibar.html#">awful.wibar</a>s, <a href="../utility_libraries/gears.wallpaper.html#">gears.wallpaper</a>s and
<a href="../popups_and_bars/awful.titlebar.html#">awful.titlebar</a>s in Awesome contain Cairo surfaces, which can be accessed through
the <code>drawin</code> API.  This allows widgets to use the Cairo context directly.
See the
<a href="../documentation/03-declarative-layout.md.html">declarative layout system</a>
and <a href="../documentation/04-new-widgets.md.html">new widgets</a> articles for more
information and examples on how widgets work.</p>

<p>It is also possible to create surfaces manually. See <a href="../libraries/gears.surface.html#">gears.surface</a> for
some examples. Here is the most simple example you can get:</p>

<pre>
<span class="comment">-- Create a surface
</span><span class="keyword">local</span> img = cairo.ImageSurface.create(cairo.Format.ARGB32, <span class="number">50</span>, <span class="number">50</span>)

<span class="comment">-- Create a context
</span><span class="keyword">local</span> cr  = cairo.Context(img)

<span class="comment">-- Set a red source
</span>cr:set_source_rgb(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)
<span class="comment">-- Alternative:
</span>cr:set_source(gears.color(<span class="string">"#ff0000"</span>))

<span class="comment">-- Add a 10px square path to the context at x=10, y=10
</span>cr:rectangle(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)

<span class="comment">-- Actually draw the rectangle on img
</span>cr:fill()
</pre>


<p>This can then be used as <code>bgimage</code> for a <a href="../popups_and_bars/wibox.html#">wibox</a>, <a href="../popups_and_bars/awful.wibar.html#">awful.wibar</a> or
<a href="../widget_containers/wibox.container.background.html#">wibox.container.background</a>:</p>

<pre>
screen.primary.mywibox.bgimage = img
</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->

<script defer type="text/javascript">
    // Theme selection and its local storage
    var select = document.getElementById("theme-select");

    var storedTheme = localStorage.getItem('theme') || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
    if (storedTheme) {
        select.value = storedTheme;
        document.documentElement.setAttribute('data-theme', storedTheme)
    }

    select.addEventListener("change", function() {
        var targetTheme = this.value;
        document.documentElement.setAttribute('data-theme', targetTheme)
        localStorage.setItem('theme', targetTheme);
    });

    const $nav = document.querySelector("#navigation");

    // When clicking the sidebar, open it
    $nav.addEventListener("click", function(ev) {
        if (document.body.clientWidth >= 768) {
            return;
        }

        const target = $nav;
        if (!target.classList.contains("open")) {
            target.classList.add("open");
            ev.stopPropagation();
        }
    });

    // When clicking anywhere else than the sidebar, close it
    document.querySelector("body").addEventListener("click", function(ev) {
        if (document.body.clientWidth >= 768 || ev.target.contains($nav)) {
            return;
        }

        const target = $nav;
        if (target.classList.contains("open")) {
            target.classList.remove("open");
        }
    });

    const copyResultClasses = {
        success : "copy-link--success",
        failure: "copy-link--failure"
    };

    const removeCopyResultClasses = ($target) =>
        Object.values(copyResultClasses).forEach(c => $target.classList.remove(c));

    document.querySelectorAll(".js-copy-link").forEach(copyLink => {
        copyLink.addEventListener("click", function(e) {
            e.preventDefault();
            const $target = e.target;

            removeCopyResultClasses($target);

            let link = $target.href;
            if (!link) {
                return;
            }
            if (link.startsWith("#")) {
                const curr = window.location.pathname;
                link = curr.substring(0, curr.indexOf("#")) + link;
            }

            // We need to create a fake element to copy the text from
            const fakeElement = document.createElement("textarea");
            fakeElement.value = link;
            document.body.appendChild(fakeElement);
            fakeElement.select();

            let success = false;
            try {
                success = document.execCommand("copy");
            } catch(err) {
                success = false;
            }

            fakeElement.remove();
            $target.classList.add(success ? copyResultClasses.success : copyResultClasses.failure);
            setInterval(() => removeCopyResultClasses($target), 1500);
        });
    });
</script>

</body>
</html>
